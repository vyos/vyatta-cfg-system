tag:
priority: 315
type: txt
help: Set bonding interface name
comp_help: Enter bonding interface name (bond0 - bond99)
syntax:expression: pattern $VAR(@) "^bond[0-9]+$" \
         ; "bonding must be (bond0-bond99)"
begin: if [ ! -f /sys/class/net/bonding_masters ]; then
           sudo modprobe bonding max_bonds=0 miimon=250
       fi
create: sudo sh -c "echo +$VAR(@) > /sys/class/net/bonding_masters" || exit 1
	ip link set "$VAR(@)" up
	/opt/vyatta/sbin/vyatta-link-detect $VAR(@) on
delete: SLAVES=`cat /sys/class/net/$VAR(@)/bonding/slaves`;
	if [ -z "$SLAVES" ]
	then 
	    sudo sh -c "echo -$VAR(@) > /sys/class/net/bonding_masters"
        else 
	   echo "bonded interface $VAR(@) still has slaves: $SLAVES"
           exit 1;           
        fi

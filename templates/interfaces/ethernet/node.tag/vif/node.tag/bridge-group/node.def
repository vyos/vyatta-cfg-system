priority: 320
help: Add this interface to a bridge group

end:
    eth=$VAR(../../@)
    vif=$VAR(../@)
    ethif=$eth.$vif
    oldbridge=`/opt/vyatta/sbin/vyatta-cli-expand-var.pl \\$VAR\(/interfaces/ethernet/$eth/vif/$vif/bridge-group/bridge/@\)`
    newbridge="$VAR(./bridge/@)"

    if [ ${COMMIT_ACTION} = 'SET' ]; then
	if [ -z "$newbridge" ]; then
	    echo "Must specify bridge name."
	    exit 1
	else
	    echo "Adding interface $ethif to bridge $newbridge."
	    sudo brctl addif $newbridge $ethif;

	    if [ -n "$VAR(./cost/@)" ]; then
		sudo brctl setpathcost $newbridge $ethif $VAR(./cost/@);
	    fi;
	    if [ -n "$VAR(./priority/@)" ]; then 
		sudo brctl setportprio $newbridge $ethif $VAR(./priority/@);
	    fi
	fi
    elif [ ${COMMIT_ACTION} = 'DELETE' ]; then
	echo "Removing interface $ethif from bridge $oldbridge."
	sudo brctl delif $oldbridge $ethif
    else
	if [ -z "$newbridge" ]; then
	    echo "Must specify bridge name."
	    exit 1
	else
	    if [ "$oldbridge" != "$newbridge" ]; then
		echo "Removing interface $ethif from bridge $oldbridge and adding it to $newbridge."
		sudo brctl delif $oldbridge $ethif
		sudo brctl addif $newbridge $ethif
	    fi
	    if [ -n "$VAR(./cost/@)" ]; then
		sudo brctl setpathcost $newbridge $ethif $VAR(./cost/@)
	    fi
	    if [ -n "$VAR(./priority/@)" ]; then 
		sudo brctl setportprio $newbridge $ethif $VAR(./priority/@)
	    fi
	fi
    fi
    exit 0


